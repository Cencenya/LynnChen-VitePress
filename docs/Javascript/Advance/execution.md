# JS代码是如何被解析执行的？

## JS引擎

> 虚拟机：一种特殊的软件，可以在计算机平台和终端用户之间创建一种环境，使得终端用户可以基于该软件所创建的环境来操作软件。有系统虚拟机和程序虚拟机之分：
> - 系统虚拟机 - 可以运行完整的操作系统，如 VMware
> - 程序虚拟机 - 也叫进程虚拟机，支持单个进程，可以运行单个计算机程序，例如 Java 虚拟机

**定义：** JS 引擎是一种虚拟机，是 JS 代码的运行环境，其作用就是将 JS 代码编译成机器可理解执行的机器代码，JavaScript解析引擎就是能够“读懂”JavaScript代码，并准确地给出代码运行结果的一段程序。比方说，当你写了 `var a = 1 + 1` 这样一段代码，JavaScript引擎做的事情就是看懂（解析）你这段代码，并且将a的值变为2。

### JS引擎与渲染引擎

渲染引擎渲染页面，JS 引擎执行 JS 代码
- 渲染引擎通过 JS 引擎提供的调用接口，使用 JS 引擎处理 JS 代码并获得结果
- JS 引擎通过桥接接口访问或修改渲染引擎生成的 DOM 树
  
![alt text](./img/0117.png)

## 阶段

>1. **词法分析（Lexical Analysis）**
>
>   JavaScript 引擎首先会对代码进行词法分析，将代码字符串分解成一个个的**词法单元（Token）**，比如关键字、标识符、运算符、分号等。
> 
> 2. **语法分析（Syntax Parsing）**
>
>   在词法分析之后，引擎会将这些**词法单元**转换成一个个的语法结构，构建出**抽象语法树（Abstract Syntax Tree，AST）**。语法分析阶段会检查代码是否符合 JavaScript 的语法规范，并在此过程中进行语法错误的检测。
> 
> 3. **执行上下文创建（Execution Context Creation）**
>
>   在代码执行之前，JavaScript 引擎会创建全局执行上下文，并将其推入执行上下文栈（Execution Context Stack）中。此后，每当函数被调用时，都会创建一个新的执行上下文，并被推入执行上下文栈的顶部。
> 
> 4. **执行代码**
>
>   引擎会按照执行上下文栈的顺序逐个执行其中的代码。在执行过程中，会根据代码的类型执行不同的操作，比如声明变量、执行函数、计算表达式等。
> 
> 5. **变量和函数声明**
>
>   在执行代码的过程中，JavaScript 引擎会将变量和函数的**声明提升（Hoisting）**，即在代码执行前先进行声明，但初始化留在原处。这意味着变量和函数可以在声明之前被使用，但如果初始化在声明之后，则会出现未定义的行为。
> 
> 6. **执行栈管理**
>
>   在函数调用时，会创建对应的执行上下文，并将其推入执行上下文栈的顶部；当函数执行完毕或返回时，对应的执行上下文会被从栈顶弹出，控制权交还给上一个执行上下文。
> 
> 7. **内存管理**
>
>   在代码执行过程中，JavaScript 引擎会负责对内存的管理，包括变量的分配、垃圾回收等操作，确保代码的正常执行和内存的有效利用。
